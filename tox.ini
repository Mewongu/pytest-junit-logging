[tox]
envlist =
    py310-pytest{6,7,8}
    py311-pytest{7,8}
    py312-pytest{8}
    py313-pytest{8}
    py314-pytest{8}
    lint
    coverage

[testenv]
deps =
    pytest6: pytest>=6.0,<7.0
    pytest7: pytest>=7.0,<8.0
    pytest8: pytest>=8.0,<9.0
    coverage: coverage[toml]
    coverage: pytest-cov
commands =
    pytest {posargs:tests/}

[testenv:py310-pytest6]
basepython = python3.10
deps =
    pytest>=6.0,<7.0

[testenv:py310-pytest7]
basepython = python3.10
deps =
    pytest>=7.0,<8.0

[testenv:py310-pytest8]
basepython = python3.10
deps =
    pytest>=8.0,<9.0

[testenv:py311-pytest7]
basepython = python3.11
deps =
    pytest>=7.0,<8.0

[testenv:py311-pytest8]
basepython = python3.11
deps =
    pytest>=8.0,<9.0

[testenv:py312-pytest8]
basepython = python3.12
deps =
    pytest>=8.0,<9.0

[testenv:py313-pytest8]
basepython = python3.13
deps =
    pytest>=8.0,<9.0
[testenv:py314-pytest8]
basepython = python3.14
deps =
    pytest>=8.0,<9.0

# Linting environment
[testenv:lint]
basepython = python3.10
deps =
    ruff
    black
    mypy
skip_install = false
commands =
    black --check --diff src/ tests/
    ruff check src/ tests/
    mypy src/

# Coverage testing
[testenv:coverage]
basepython = python3.10
deps =
    pytest>=8.0
    coverage[toml]
    pytest-cov
commands =
    coverage erase
    pytest --cov=src/pytest_junit_logging --cov-report=term-missing --cov-report=html:reports/coverage --cov-report=xml:reports/coverage.xml tests/
    coverage report --fail-under=85

# Integration testing with real examples
[testenv:integration]
basepython = python3.10
deps = pytest>=8.0
changedir = {toxinidir}
commands =
    # Run all tests including integration tests (tests/test_integration.py)
    pytest tests/ -v

# Minimum version testing
[testenv:mindeps]
basepython = python3.10
deps =
    pytest==6.0.0  # Minimum supported pytest version
commands = pytest tests/

[pytest]
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
addopts = -v --tb=short

[coverage:run]
source = src/pytest_junit_logging
omit =
    tests/*
    */tests/*

[coverage:report]
exclude_lines =
    pragma: no cover
    def __repr__
    if self.debug:
    if settings.DEBUG
    raise AssertionError
    raise NotImplementedError
    if 0:
    if __name__ == .__main__.:
    class .*\bProtocol\):
    @(abc\.)?abstractmethod
